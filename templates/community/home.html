{% extends 'community/base.html' %}
{% load static %}

{% block content %}



<main id="main-background" class="pt-5 ">

    <div class="col-12 row   d-flex justify-content-center align-items-center pb-3 border-0 rounded m-1">

        <!-- Title and user-specific greeting -->
        <div class="col-8 container mt-4 d-flex d-md-none justify-content-center ">
            <h1 class="h1 text-center"> Welcome to <br> the Community <br> Center</h1>
        </div>

        <div class="col-8 container mt-4 d-none  d-md-flex justify-content-center ">
            <h1 class="h1 text-center"> Welcome to the Community Center</h1>
        </div>


    </div>
    </div>
    <div class="row d-flex d-md-none justify-content-center align-items-center ">
        <!-- Section displaying event categories and a carousel of event images -->
        <div class="d-none  col-md-3 event-info">
            <h3 class="text-center">Types of Events</h3>
            <p class="text-center ">Maths Tutoring: Enhance your skills with expert tutors.Yoga for Wellness:
                Stretch and strengthen your body.
                Chess Championship: Showcase your strategic prowess.
                <p> And more .... </p>
        </div>
        <div class="col-11  h-75">

            <div class="banner-container">
                <div id="bannerCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="10000">

                    <div class="carousel-item active">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521728/pexels-katerina-holmes-5905456_zkqiwh.jpg"
                            class="d-block w-100" data-bs-event="maths-tutor" alt=" Maths Tutoring Event">
                    </div>
                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521726/pexels-yan-krukau-8436587_r5ahji.jpg"
                            class="d-block w-100" data-bs-event="yoga" alt=" Yoga Event">
                    </div>

                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521726/pexels-alex-green-5692696_rlmgle.jpg"
                            class="d-block w-100" data-bs-event="chess" alt=" Chess Event">
                    </div>

                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521724/pexels-%E7%A5%9D-%E9%B9%A4%E6%A7%90-716276_avkbnm.jpg"
                            class="d-block w-100" data-bs-event="gallery" alt=" Gallery  Event">
                    </div>

                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521723/pexels-budgeron-bach-5149649_soauqj.jpg"
                            class="d-block w-100" data-bs-event="dance" alt=" Dancing event">
                    </div>

                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521718/pexels-orkhan-shahbaz-18751164_vuz7uu.jpg"
                            class="d-block w-100" data-bs-event="politic" alt=" Political  Event">
                    </div>

                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521641/first-aid_mf3tfy.png"
                            class="d-block w-100" data-bs-event="firstaid" alt=" First Aid  Event">
                    </div>
                    <button class="carousel-control-prev  standard opacity-0.05" id="carousel-button" type="button"
                        data-bs-target="#bannerCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>

                    <button class="carousel-control-next standard opacity-0.05 " id="carousel-button" type="button"
                        data-bs-target="#bannerCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div class="col-12 pb-4 d-flex justify-content-between align-items-center d-md-none">
        <div class="col-12  align-items-center text-center mt-3">
            <p class="leading ">
                <!-- Check if user is authenticated -->
                {% if user.is_authenticated %}

                Hi , {{ user.profile }}
                <!-- Display 'Create an Event' option for certain user roles -->
                {% endif %}
                {% if user.profile.role == 'INSTRUCTOR' or user.profile.role == 'GOVERNMENT' %}
                <div class="mt-4 col-12 row  d-flex justify-content-center align-items-center d-md-none ">
                    <div class="col-12 col-md-6 d-flex justify-content-center align-items-center">
                        <a href="{% url 'create_event' %}"><button>
                                <span class="button_top"> Create an Event </span>
                            </button> </a>
                    </div>

                    <div
                        class=" mt-4  mb-4 col-12 col-md-6 d-flex justify-content-center align-items-center d-md-none ">
                        <a href="{% url 'logout' %}"> <button>
                                <span class="button_top"> Logout </span>
                            </button> </a>
                    </div>
                </div>


                {% else %}
                <!-- Login and sign up options for unauthenticated users -->
                <div class="mt-4 col-12   d-flex justify-content-center align-items-center d-md-none ">

                    <a href="{% url 'login' %}"> <button>
                            <span class="button_top"> Login </span>
                        </button>
                    </a>
                </div>
                <div class="mt-4 col-12   d-flex justify-content-center align-items-center d-md-none ">
                    <a href="{% url 'register_public' %}"><button>
                            <span class="button_top"> Sign up </span>
                        </button>
                    </a>
                </div>
                <div class="mt-4 col-12   d-flex justify-content-center align-items-center d-md-none ">

                    <a href="{% url 'register_instructor'  %}"><button>
                            <span class="button_top"> Sign up as an Instructor </span>
                        </button>
                    </a>
                </div>
                <div class="mt-4 col-12   d-flex justify-content-center align-items-center d-md-none "></div>
                <a href="{% url  'register_government' %}"><button>
                        <span class="button_top"> Sign up as an Official </span>
                    </button>
                </a>
                {% endif %}

        </div>
    </div>
    </div>
    <div class="d-none row  pb-4 d-md-flex justify-content-around">
        <!-- Section displaying event categories and a carousel of event images -->
        <div class=" col-md-5 col-lg-4  ms-3 ps-2 event-info bg-light border-0 rounded">
            <h3 class="text-center mt-3 ">Types of Events</h3>
            <p class="text-center ">Enhance your skills with expert tutors.
                Stretch and strengthen your body with specialists. Obtain government approved qualifications.
                Chess Championship: Showcase your strategic prowess.
                <br> And more ..... </p>
        </div>
        <div class=" col-md-6 h-75">

            <div class="banner-container">
                <div id="bannerCarousel1" class="carousel slide" data-bs-ride="carousel" data-bs-interval="10000">

                    <div class="carousel-item active">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521728/pexels-katerina-holmes-5905456_zkqiwh.jpg"
                            class="d-block w-100" data-bs-event="maths-tutor" alt=" Maths Tutoring Event">
                    </div>
                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521726/pexels-yan-krukau-8436587_r5ahji.jpg"
                            class="d-block w-100" data-bs-event="yoga" alt=" Yoga Event">
                    </div>

                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521726/pexels-alex-green-5692696_rlmgle.jpg"
                            class="d-block w-100" data-bs-event="chess" alt=" Chess Event">
                    </div>

                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521724/pexels-%E7%A5%9D-%E9%B9%A4%E6%A7%90-716276_avkbnm.jpg"
                            class="d-block w-100" data-bs-event="gallery" alt=" Gallery  Event">
                    </div>

                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521723/pexels-budgeron-bach-5149649_soauqj.jpg"
                            class="d-block w-100" data-bs-event="dance" alt=" Dancing event">
                    </div>

                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521718/pexels-orkhan-shahbaz-18751164_vuz7uu.jpg"
                            class="d-block w-100" data-bs-event="politic" alt=" Political  Event">
                    </div>

                    <div class="carousel-item">
                        <img src="https://res.cloudinary.com/dwz6t9jry/image/upload/v1700521641/first-aid_mf3tfy.png"
                            class="d-block w-100" data-bs-event="firstaid" alt=" First Aid  Event">
                    </div>
                    <button class="carousel-control-prev  standard opacity-0.05" id="carousel-button" type="button"
                        data-bs-target="#bannerCarousel1" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>

                    <button class="carousel-control-next standard opacity-0.05 " id="carousel-button" type="button"
                        data-bs-target="#bannerCarousel1" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12 row pb-4 d-none d-md-flex justify-content-center align-items-center ">
        <div class="col-12  align-items-center text-center mt-3">
            <p class="leading ">
                <!-- Check if user is authenticated -->
                {% if user.is_authenticated %}

                Hi , {{ user.profile }}
                <!-- Display 'Create an Event' option for certain user roles -->
                {% endif %} </p>
        </div>
        {% if user.profile.role == 'INSTRUCTOR' or user.profile.role == 'GOVERNMENT' %}
        <div class="mt-4 col-6   d-flex justify-content-end align-items-center  ">

            <a href="{% url 'create_event' %}"><button>
                    <span class="button_top"> Create an Event </span>
                </button> </a>
        </div>

        <div class=" mt-4   col-6 d-flex justify-content-start align-items-center ">
            <a href="{% url 'logout' %}"> <button>
                    <span class="button_top"> Logout </span>
                </button> </a>
        </div>



        {% else %}
        <!-- Login and sign up options for unauthenticated users -->

        <div class="mt-4 col-5 col-lg-3  d-flex justify-content-center align-items-center  ">

            <a href="{% url 'login' %}"> <button>
                    <span class="button_top"> Login </span>
                </button>
            </a>
        </div>

        <div class="mt-4 col-5  col-lg-3  d-flex justify-content-center align-items-center  ">

            <a href="{% url 'register_instructor'  %}"><button>
                    <span class="button_top"> Sign up as an Instructor </span>
                </button>
            </a>
        </div>

        <div class="mt-4 col-5  col-lg-3  d-flex justify-content-center align-items-center  ">
            <a href="{% url 'register_public' %}"><button>
                    <span class="button_top"> Sign up </span>
                </button>
            </a>
        </div>
        
        <div class="mt-4 col-5 col-lg-3   d-flex justify-content-center align-items-center  ">
        <a href="{% url  'register_government' %}"><button>
                <span class="button_top"> Sign up as an Official </span>
            </button>
        </a>
    </div>
        {% endif %}

   
    </div>
    </div>
    </div>



    {% if created_events %}
    <!-- ... Content for displaying created events ... -->
    <div class="container mt-5 carousel-inner border-0 rounded">
        <div class="row">
            <div class="col-12 d-flex text-center justify-content-center ">
                <h2 class="display-4"> Your Created Events:</h2>
            </div>
        </div>
        <div class="row">
            {% for event in created_events %}
            <div class="col-md-4 mb-3 ">
                <div class="card card-opacity border-0 justify-content-center align-items-center">


                    <strong>{{ event.title }}</strong>
                    {% if event.image %}
                    <img src="{{ event.image.url }}" alt="Event Image">
                    {% endif %}
                    <p>Date: {{ event.date }}</p>
                    <p>Start Time : {{ event.time }}</p>
                    <p> Capacity: {{ event.capacity }}</p>
                    <p> Cost: Â£ {% if event.author.role == 'INSTRUCTOR' %}
                        7.00
                        {% else %}
                        0.00
                        {% endif %} </p>

                    <button class="btn btn-primary w-75 standard" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapse{{ forloop.counter }}" aria.expanded="false"
                        aria-controls="collapse{{ forloop.counter }}"> More Info </button>

                    <div class="collapse" id="collapse{{ forloop.counter }}">
                        <div class="card card-body">{{ event.description }}</div>
                    </div>
                    <div class="row p-1 d-flex justify-content-center  ">
                        <div class="col-6 ">
                            {% if event.capacity < 60 %}
                            <a href="{% url  'update_event' event.id %}"> <button class=" ms-md-1 ms-lg-3 standard"> Update
                                </button> </a>
                            {% else %}
                            <a href="{% url  'update_event' event.id %}"> <button class="standard"> Update </button>
                            </a>
                            {% endif %}
                        </div>
                        <div class="col-6">
                            {% if event.capacity >= 60 %}
                            <a href="{% url 'delete_event' event.id %}"><button class="standard"> Delete </button> </a>
                            {% else %}
                            <p class="ms-md-1"> Event deletion is disabled after public booking of course </p>
                            <button class="btn btn-danger standard disabled">Delete </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}

        {% endif %}
    </div>
    </div>
    <!-- ... Content for displaying joined events ... -->
    {% if user.is_authenticated and joined_events %}

    <div class="container mt-5 carousel-inner border-0 rounded">
        <div class="row ">
            <div class="col-12 d-flex text-center justify-content-center">
                <h2> Events You have Joined :</h2>
            </div>
        </div>
        <div class="row">
            {% for event in joined_events %}
            <div class="col-md-4">
                <div class="card card-opacity border-0 mb-4">
                    <div>
                        <strong> {{ event.title }}</strong> by {{ event.author.user.username }}
                    </div>
                    <div class="card-body">
                        <p> {{ event.date|date:"l, F j , Y" }}-{{ event.time }} </p>
                        <button class="btn btn-primary standard" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse{{ forloop.counter }}" aria.expanded="false"
                            aria-controls="collapse{{ forloop.counter }}"> More Info </button>
                    </div>
                    <div class="collapse" id="collapse{{ forloop.counter }}">
                        <div class="card card-body">{{ event.description }}</div>
                    </div>
                </div>
            </div>
            {% endfor %}

        </div>
        {% else %}

        {% endif %}
    </div> <!-- ... Content for displaying user's balance and recent transactions ... -->
    {% if user.is_authenticated %}
    <div class="container mt-5 mb-3 pb-4 ">
        <div class="row align-items-start carousel-inner border-0 rounded m-1">
            <div class="col-8 col-md-4">

                <h3> Your Balance: {{ user.profile.balance }}</h3>
                <h4> Recent Transactions </h4>
                <ul class="budget-list">
                    {% for transaction in balance_transactions %}
                    <li class="budget-list"> {{ transaction.create_at }} {{ transaction.amount }}
                        {{ transaction.transaction_type }}
                    </li>
                    {% empty %}
                    <li class="budget-list"> No recent transactions.</li>
                    {% endfor %}
                </ul>

            </div>
            <div class="d-none d-md-inline-block col-8">
                <canvas id="transactionGraph" width='300' height="150"></canvas>
            </div>
            {% endif %}
        </div>
    </div>
    </div>
    </div>
</main><!-- ... Script for initializing the chart ... -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- JavaScript for Chart.js to display transaction history graphically -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const transactionDates = JSON.parse('{{ transaction_dates|safe }}');
        const transactionAmounts = JSON.parse('{{ transaction_amounts|safe }}');
        const ctx = document.getElementById('transactionGraph').getContext('2d');
        const transactionGraph = new Chart(ctx, {
            type: 'line',
            data: {
                labels: transactionDates,
                datasets: [{
                    label: 'Transaction History',
                    data: transactionAmounts,
                    backgroundColor: 'rgba(54,162,235,0.2)',
                    borderColor: 'rgba(54,162,235,1)',
                    borderWidth: 3,
                    tension: 0.4,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: 'rgba(54,162,235,1)',
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    fill: true,

                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: false
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 14
                            }
                        }
                    }
                },
                responsive: true,
                maintainAspectRatio: false
            }
        });
    });
</script>


{% endblock content %}